<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FC Zondag</title>
    
    <link rel="icon" type="image/png" href="icon.png">
    <link rel="apple-touch-icon" href="icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#15803d">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F3F4F6; -webkit-tap-highlight-color: transparent; }
        .card-shadow { box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.15); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
    </style>
</head>
<body class="flex justify-center min-h-screen bg-gray-100 pt-6 px-4 pb-12">

    <div class="w-full max-w-sm bg-white rounded-[32px] card-shadow overflow-hidden relative flex flex-col">
        
        <div class="bg-[#15803d] pt-8 pb-8 px-6 text-white text-center relative overflow-hidden min-h-[180px] flex flex-col justify-center">
            <div class="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]"></div>
            <h1 class="font-black text-2xl tracking-tight relative z-10 mb-4">FC Zondag Futsal</h1>
            <div class="relative z-10">
                <div id="header-read-mode" class="hidden bg-white/10 backdrop-blur-md rounded-xl p-3 border border-white/20 group relative">
                    <p id="header-text-display" class="font-bold text-sm leading-relaxed text-green-50 whitespace-pre-line py-1">Laden...</p>
                    <button onclick="clearHeader()" class="absolute -top-2 -right-2 bg-red-500 text-white p-1.5 rounded-full shadow-sm opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-600 hover:scale-110" title="Wissen">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 000-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
                    </button>
                </div>
                <div id="header-edit-mode" class="hidden animate-fade-in">
                    <textarea id="header-input" rows="2" placeholder="â„¹ï¸ Vul hier datum, tijd & locatie in voor deze week..." class="w-full p-2 text-center text-gray-800 font-bold bg-white/90 border-2 border-green-300/50 rounded-xl focus:outline-none focus:ring-2 focus:ring-white transition placeholder-gray-500 text-sm resize-none"></textarea>
                    <button onclick="saveHeader()" class="mt-2 bg-white text-[#15803d] text-xs font-black px-4 py-2 rounded-full shadow hover:bg-green-50 transition uppercase tracking-widest">Opslaan op prikbord</button>
                </div>
            </div>
        </div>

        <div class="px-6 -mt-6 relative z-20">
            <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100 text-center">
                <p class="text-gray-400 font-semibold text-xs uppercase tracking-wider mb-1">
                    Huidig aantal aanwezig
                </p>
                <div class="text-[#15803d] font-black text-6xl tracking-tighter leading-none" id="headcount-display">0</div>
                <p class="text-xs text-gray-400 font-medium mt-2" id="headcount-status">Laden...</p>
            </div>
        </div>

        <div class="px-6 py-6 space-y-4">
            <input type="text" id="name-input" placeholder="Vul je naam in..." class="w-full p-4 text-center text-gray-800 font-bold bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:bg-white transition placeholder-gray-400">
            <div class="grid grid-cols-1 gap-3">
                <button onclick="submit('in')" class="w-full bg-[#15803d] hover:bg-green-800 active:scale-[0.98] transition text-white font-bold py-4 rounded-xl shadow-md flex justify-center items-center gap-2 text-lg">
                    <span class="bg-white/20 rounded-full p-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg></span>
                    Ik doe mee
                </button>
                <button onclick="submit('out')" class="w-full bg-white border-2 border-gray-100 hover:bg-gray-50 text-gray-400 font-bold py-3.5 rounded-xl active:scale-[0.98] transition flex justify-center items-center gap-2 text-sm">
                    Helaas, ik kan niet
                </button>
            </div>
            <div class="text-center pt-2">
                <button onclick="toggleGuest()" class="text-[#15803d] text-xs font-bold uppercase tracking-wide hover:underline flex items-center justify-center gap-1 mx-auto opacity-80 hover:opacity-100 transition">
                    + Gastspeler toevoegen
                </button>
                <div id="guest-panel" class="hidden mt-3 bg-green-50 p-3 rounded-xl border border-green-100 animate-fade-in">
                    <input id="guest-name" type="text" placeholder="Naam van gast..." class="w-full p-2 mb-2 rounded border border-green-200 text-sm focus:outline-none focus:border-green-500">
                    <button onclick="submitGuest()" class="w-full bg-[#15803d] text-white py-2 rounded-lg font-bold text-xs shadow-sm">BEVESTIG GAST</button>
                </div>
            </div>
        </div>

        <div class="bg-gray-50 border-t border-gray-200 flex-grow">
            <div class="p-6 pb-2">
                <h3 class="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-4">Aanwezig (<span id="count-in">0</span>)</h3>
                <div id="list-in" class="space-y-2"></div>
            </div>
            <div class="p-6 pt-0 pb-12">
                <h3 class="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-4 mt-4">Afwezig (<span id="count-out">0</span>)</h3>
                <div id="list-out" class="space-y-2 opacity-50 grayscale"></div>
            </div>
             <div class="pb-8 text-center">
                <button onclick="resetList()" class="text-[9px] text-gray-300 hover:text-red-400 font-mono uppercase tracking-widest transition p-4">
                    [ Admin: Start Nieuwe Week ]
                </button>
            </div>
        </div>

        <div id="loader" class="absolute inset-0 bg-white/95 z-50 flex flex-col justify-center items-center backdrop-blur-sm transition-opacity duration-300">
            <div class="animate-spin rounded-full h-12 w-12 border-4 border-gray-100 border-t-[#15803d]"></div>
            <p id="loader-text" class="text-gray-500 font-bold mt-4 text-xs tracking-wide animate-pulse">GEGEVENS OPHALEN...</p>
        </div>

    </div>

    <script>
        // *** CONFIGURATIE ***
        // ðŸ‘‡ðŸ‘‡ðŸ‘‡ PLAK HIER JOUW GOOGLE SCRIPT URL ðŸ‘‡ðŸ‘‡ðŸ‘‡
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwKpEIkK07_D-4UL2UHGjdx4WAzW9I_ti9uYO4-5D-OQXbng9_vDDHcRbYv5Gn_-VJu/exec"; 
        
        // Nieuwe cache key
        const CACHE_KEY = 'fc_zondag_v7_fixed'; 
        let players = [];
        let currentHeader = "";

        async function loadData() {
            const cached = localStorage.getItem(CACHE_KEY);
            if(cached) {
                const parsed = JSON.parse(cached);
                players = parsed.players || [];
                currentHeader = parsed.header || "";
                render();
                document.getElementById('loader').classList.add('hidden');
            }

            try {
                const res = await fetch(GOOGLE_SCRIPT_URL);
                const data = await res.json();
                if (JSON.stringify(data.players) !== JSON.stringify(players) || data.header !== currentHeader) {
                    players = data.players || [];
                    currentHeader = data.header || "";
                    localStorage.setItem(CACHE_KEY, JSON.stringify({header: currentHeader, players: players}));
                    render();
                }
            } catch(e) {
                console.error("Geen verbinding", e);
                if(!cached) document.getElementById('loader').classList.add('hidden');
            } finally {
                 // DE FIX: ALTIJD de loader verbergen als we klaar zijn, ook als de lijst leeg is.
                 document.getElementById('loader').classList.add('hidden');
            }
